<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïò§ÎäòÏùò Ïö∞Ï£º ÏÇ¨ÏßÑ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #64b5f6, #e1bee7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav button {
            padding: 10px 30px;
            background: rgba(100, 181, 246, 0.2);
            border: 2px solid #64b5f6;
            color: #ffffff;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .nav button:hover {
            background: rgba(100, 181, 246, 0.4);
            transform: translateY(-2px);
        }

        .nav button.active {
            background: #64b5f6;
        }

        .date-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .date-selector label {
            font-size: 1.1rem;
        }

        .date-selector input {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(100, 181, 246, 0.5);
            border-radius: 8px;
            color: #ffffff;
            font-size: 1rem;
        }

        .date-selector input::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }

        .main-view {
            display: none;
        }

        .main-view.active {
            display: block;
        }

        .apod-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .image-section {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .image-section img {
            width: 100%;
            height: auto;
            display: block;
        }

        .image-section iframe {
            width: 100%;
            aspect-ratio: 16/9;
            border: none;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-section h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #64b5f6;
        }

        .info-section .date {
            font-size: 0.9rem;
            color: #b0bec5;
            margin-bottom: 20px;
        }

        .info-section .description {
            line-height: 1.8;
            font-size: 1.05rem;
            color: #e0e0e0;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .gallery-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(100, 181, 246, 0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .gallery-item .info {
            padding: 20px;
        }

        .gallery-item h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #64b5f6;
        }

        .gallery-item .date {
            font-size: 0.85rem;
            color: #b0bec5;
            margin-bottom: 10px;
        }

        .gallery-item .excerpt {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e0e0e0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #64b5f6;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #ff6b6b;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .apod-container {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8rem;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .nav {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåå Ïò§ÎäòÏùò Ïö∞Ï£º ÏÇ¨ÏßÑ</h1>
            <div class="nav">
                <button id="todayBtn" class="active">Ïò§ÎäòÏùò ÏÇ¨ÏßÑ</button>
                <button id="galleryBtn">Í∞§Îü¨Î¶¨</button>
            </div>
        </header>

        <div class="date-selector" id="dateSelector">
            <label for="dateInput">ÎÇ†Ïßú ÏÑ†ÌÉù:</label>
            <input type="date" id="dateInput" max="">
        </div>

        <div id="todayView" class="main-view active">
            <div id="apodContent"></div>
        </div>

        <div id="galleryView" class="main-view">
            <div id="galleryContent" class="gallery-grid"></div>
        </div>
    </div>

    <script>
        // API ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏÑ§Ï†ï (Î°úÏª¨ Í∞úÎ∞úÏãúÏôÄ Î∞∞Ìè¨Ïãú ÏûêÎèô Ï†ÑÌôò)
        const API_ENDPOINT = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'https://api.nasa.gov/planetary/apod?api_key=3ZpWN3RhyIixEUngGlXmO8a23VTg7cUyvaIA32wR'
            : '/api/apod';
        
        const USE_PROXY = !(window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1');

        const dateInput = document.getElementById('dateInput');
        const todayBtn = document.getElementById('todayBtn');
        const galleryBtn = document.getElementById('galleryBtn');
        const todayView = document.getElementById('todayView');
        const galleryView = document.getElementById('galleryView');
        const apodContent = document.getElementById('apodContent');
        const galleryContent = document.getElementById('galleryContent');
        const dateSelector = document.getElementById('dateSelector');

        // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
        const today = new Date().toISOString().split('T')[0];
        dateInput.max = today;
        dateInput.value = today;

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        todayBtn.addEventListener('click', () => {
            todayBtn.classList.add('active');
            galleryBtn.classList.remove('active');
            todayView.classList.add('active');
            galleryView.classList.remove('active');
            dateSelector.style.display = 'flex';
        });

        galleryBtn.addEventListener('click', () => {
            galleryBtn.classList.add('active');
            todayBtn.classList.remove('active');
            galleryView.classList.add('active');
            todayView.classList.remove('active');
            dateSelector.style.display = 'none';
            loadGallery();
        });

        // ÎÇ†Ïßú ÏÑ†ÌÉù
        dateInput.addEventListener('change', () => {
            loadAPOD(dateInput.value);
        });

        // APOD Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadAPOD(date) {
            apodContent.innerHTML = '<div class="loading">Î°úÎî© Ï§ë...</div>';
            
            try {
                const url = USE_PROXY 
                    ? `${API_ENDPOINT}?date=${date}`
                    : `${API_ENDPOINT}&date=${date}`;
                    
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
                
                const data = await response.json();
                displayAPOD(data);
            } catch (error) {
                apodContent.innerHTML = `<div class="error">Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}</div>`;
            }
        }

        // APOD ÌëúÏãú
        function displayAPOD(data) {
            const mediaContent = data.media_type === 'video' 
                ? `<iframe src="${data.url}" allowfullscreen></iframe>`
                : `<img src="${data.url}" alt="${data.title}">`;

            apodContent.innerHTML = `
                <div class="apod-container">
                    <div class="image-section">
                        ${mediaContent}
                    </div>
                    <div class="info-section">
                        <h2>${data.title}</h2>
                        <div class="date">${formatDate(data.date)}</div>
                        <div class="description">${translateExplanation(data.explanation)}</div>
                    </div>
                </div>
            `;
        }

        // Í∞§Îü¨Î¶¨ Î°úÎìú
        async function loadGallery() {
            if (galleryContent.innerHTML !== '') return;
            
            galleryContent.innerHTML = '<div class="loading">Í∞§Îü¨Î¶¨ Î°úÎî© Ï§ë...</div>';
            
            try {
                const dates = getRandomDates(6);
                const promises = dates.map(date => {
                    const url = USE_PROXY 
                        ? `${API_ENDPOINT}?date=${date}`
                        : `${API_ENDPOINT}&date=${date}`;
                    return fetch(url).then(r => r.json());
                });
                
                const results = await Promise.all(promises);
                displayGallery(results);
            } catch (error) {
                galleryContent.innerHTML = `<div class="error">Í∞§Îü¨Î¶¨Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§: ${error.message}</div>`;
            }
        }

        // Í∞§Îü¨Î¶¨ ÌëúÏãú
        function displayGallery(items) {
            galleryContent.innerHTML = items.map(item => {
                const thumbnail = item.media_type === 'video' 
                    ? `https://img.youtube.com/vi/${getYouTubeID(item.url)}/hqdefault.jpg`
                    : item.url;
                
                return `
                    <div class="gallery-item" onclick="viewGalleryItem('${item.date}')">
                        <img src="${thumbnail}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/350x250?text=Ïö∞Ï£º+Ïù¥ÎØ∏ÏßÄ'">
                        <div class="info">
                            <h3>${item.title}</h3>
                            <div class="date">${formatDate(item.date)}</div>
                            <div class="excerpt">${item.explanation.substring(0, 150)}...</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Í∞§Îü¨Î¶¨ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠
        function viewGalleryItem(date) {
            dateInput.value = date;
            todayBtn.click();
            loadAPOD(date);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ÎûúÎç§ ÎÇ†Ïßú ÏÉùÏÑ± (ÏµúÍ∑º 1ÎÖÑ)
        function getRandomDates(count) {
            const dates = [];
            const today = new Date();
            
            for (let i = 0; i < count; i++) {
                const randomDays = Math.floor(Math.random() * 365);
                const date = new Date(today);
                date.setDate(date.getDate() - randomDays);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            return dates;
        }

        // ÎÇ†Ïßú Ìè¨Îß∑
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        }

        // YouTube ID Ï∂îÏ∂ú
        function getYouTubeID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Í∞ÑÎã®Ìïú ÏÑ§Î™Ö Î≤àÏó≠ (Ïã§Ï†úÎ°úÎäî Î≤àÏó≠ API ÌïÑÏöî)
        function translateExplanation(text) {
            // Ïã§Ï†ú ÌôòÍ≤ΩÏóêÏÑúÎäî Î≤àÏó≠ APIÎ•º ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§
            // Ïó¨Í∏∞ÏÑúÎäî ÏõêÎ¨∏ÏùÑ Í∑∏ÎåÄÎ°ú Î∞òÌôò
            return text;
        }

        // Ï¥àÍ∏∞ Î°úÎìú
        loadAPOD(today);
    </script>
</body>
</html>
