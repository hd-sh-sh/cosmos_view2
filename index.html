<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSMOS — Astronomy Picture of the Day</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-cosmic-dark: #0A0E1A;
            --color-cosmic-night: #151B2D;
            --color-stellar-silver: #B8C5D6;
            --color-nebula-blue: #5B7C99;
            --color-galaxy-cyan: #7BA8C9;
            --color-text-primary: #FFFFFF;
            --color-text-secondary: #A8B5C7;
            --color-accent: #85A5CC;
            --color-accent-light: #A8C7E8;
            --font-display: 'Playfair Display', serif;
            --font-body: 'DM Sans', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-cosmic-dark);
            color: var(--color-text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(123, 168, 201, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(91, 124, 153, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            padding: 60px 0 40px;
            border-bottom: 1px solid rgba(245, 245, 247, 0.1);
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            background: linear-gradient(135deg, #FFFFFF 0%, var(--color-stellar-silver) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
        }

        .nav {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            padding: 6px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .nav button {
            padding: 12px 28px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            font-family: var(--font-body);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .nav button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--color-accent-light), var(--color-galaxy-cyan));
            border-radius: 50px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav button:hover {
            color: var(--color-text-primary);
        }

        .nav button.active {
            color: var(--color-cosmic-dark);
        }

        .nav button.active::before {
            opacity: 1;
        }

        .nav button span {
            position: relative;
            z-index: 1;
        }

        /* Date Selector */
        .date-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 60px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .date-selector label {
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .date-selector input {
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--color-text-primary);
            font-size: 1rem;
            font-family: var(--font-body);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .date-selector input:focus {
            outline: none;
            border-color: var(--color-accent-light);
            background: rgba(255, 255, 255, 0.08);
        }

        .date-selector input::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        /* Main Views */
        .main-view {
            display: none;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .main-view.active {
            display: block;
        }

        /* Today View */
        .apod-container {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 60px;
            align-items: start;
            margin-bottom: 100px;
        }

        .image-section {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.03);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: scaleIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .image-section img {
            width: 100%;
            height: auto;
            display: block;
            animation: fadeIn 0.6s ease-out 0.3s both;
        }

        .image-section iframe {
            width: 100%;
            aspect-ratio: 16/9;
            border: none;
        }

        .info-section {
            position: sticky;
            top: 40px;
            animation: fadeInRight 0.8s ease-out 0.2s both;
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .info-section .date {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-accent-light);
            margin-bottom: 16px;
            font-weight: 600;
        }

        .info-section h2 {
            font-family: var(--font-display);
            font-size: 2.8rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 24px;
            color: var(--color-text-primary);
            letter-spacing: -0.02em;
        }

        .info-section .description {
            font-size: 1.05rem;
            line-height: 1.8;
            color: var(--color-text-secondary);
            margin-bottom: 32px;
        }

        .info-section .original-title {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            font-style: italic;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 24px;
        }

        /* Gallery */
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .gallery-header h2 {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 700;
        }

        .refresh-gallery {
            padding: 14px 32px;
            background: linear-gradient(135deg, var(--color-stellar-gold), var(--color-accent));
            border: none;
            color: var(--color-cosmic-dark);
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: var(--font-body);
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        .refresh-gallery:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.4);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 100px;
        }

        .gallery-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            animation: fadeInUp 0.6s ease-out both;
        }

        .gallery-item:nth-child(1) { animation-delay: 0.1s; }
        .gallery-item:nth-child(2) { animation-delay: 0.2s; }
        .gallery-item:nth-child(3) { animation-delay: 0.3s; }
        .gallery-item:nth-child(4) { animation-delay: 0.4s; }
        .gallery-item:nth-child(5) { animation-delay: 0.5s; }

        .gallery-item:hover {
            transform: translateY(-8px);
            border-color: var(--color-stellar-gold);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .gallery-item-image {
            position: relative;
            overflow: hidden;
            aspect-ratio: 16/10;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-item .info {
            padding: 24px;
        }

        .gallery-item .date {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-stellar-gold);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .gallery-item h3 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--color-text-primary);
            line-height: 1.3;
        }

        .gallery-item .excerpt {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--color-text-secondary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Loading & Error */
        .loading {
            text-align: center;
            padding: 100px 20px;
            font-size: 1.2rem;
            color: var(--color-stellar-gold);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error {
            text-align: center;
            padding: 100px 20px;
            color: var(--color-accent);
            font-size: 1.1rem;
        }

        /* Footer */
        footer {
            padding: 60px 0;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .container {
                padding: 0 24px;
            }

            .apod-container {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .info-section {
                position: relative;
                top: 0;
            }

            .info-section h2 {
                font-size: 2rem;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .gallery-header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }

            .logo {
                font-size: 1.8rem;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">COSMOS</div>
                <nav class="nav">
                    <button id="todayBtn" class="active"><span>오늘의 우주</span></button>
                    <button id="galleryBtn"><span>갤러리</span></button>
                </nav>
            </div>
        </header>

        <div class="date-selector" id="dateSelector">
            <label for="dateInput">날짜 선택</label>
            <input type="date" id="dateInput" max="">
        </div>

        <div id="todayView" class="main-view active">
            <div id="apodContent"></div>
        </div>

        <div id="galleryView" class="main-view">
            <div class="gallery-header">
                <h2>우주 탐험</h2>
                <button class="refresh-gallery" id="refreshGallery">다른 사진 보기</button>
            </div>
            <div id="galleryContent" class="gallery-grid"></div>
        </div>

        <footer>
            <p>NASA Astronomy Picture of the Day • 이미지 및 데이터 제공: NASA</p>
        </footer>
    </div>

    <script>
        // 별 애니메이션 생성
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        createStars();

        // API 엔드포인트 설정
        const API_ENDPOINT = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'https://api.nasa.gov/planetary/apod?api_key=3ZpWN3RhyIixEUngGlXmO8a23VTg7cUyvaIA32wR'
            : '/api/apod';
        
        const USE_PROXY = !(window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1');

        const dateInput = document.getElementById('dateInput');
        const todayBtn = document.getElementById('todayBtn');
        const galleryBtn = document.getElementById('galleryBtn');
        const refreshGallery = document.getElementById('refreshGallery');
        const todayView = document.getElementById('todayView');
        const galleryView = document.getElementById('galleryView');
        const apodContent = document.getElementById('apodContent');
        const galleryContent = document.getElementById('galleryContent');
        const dateSelector = document.getElementById('dateSelector');

        // 오늘 날짜 설정
        const today = new Date().toISOString().split('T')[0];
        dateInput.max = today;
        dateInput.value = today;

        // 네비게이션
        todayBtn.addEventListener('click', () => {
            todayBtn.classList.add('active');
            galleryBtn.classList.remove('active');
            todayView.classList.add('active');
            galleryView.classList.remove('active');
            dateSelector.style.display = 'flex';
        });

        galleryBtn.addEventListener('click', () => {
            galleryBtn.classList.add('active');
            todayBtn.classList.remove('active');
            galleryView.classList.add('active');
            todayView.classList.remove('active');
            dateSelector.style.display = 'none';
            if (galleryContent.innerHTML === '') {
                loadGallery();
            }
        });

        // 갤러리 새로고침
        refreshGallery.addEventListener('click', () => {
            galleryContent.innerHTML = '';
            loadGallery();
        });

        // 날짜 선택
        dateInput.addEventListener('change', () => {
            loadAPOD(dateInput.value);
        });

        // 한글 번역 함수 (Papago API를 사용하거나 간단한 번역)
        async function translateToKorean(text) {
            // 실제 서비스에서는 번역 API를 사용하는 것이 좋습니다
            // 여기서는 클라이언트 측에서 간단한 번역을 시도합니다
            
            try {
                // Google Translate API 무료 엔드포인트 사용 (비공식)
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ko&dt=t&q=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data[0]) {
                    return data[0].map(item => item[0]).join('');
                }
            } catch (error) {
                console.log('번역 실패, 원문 사용:', error);
            }
            
            return text;
        }

        // APOD 데이터 로드
        async function loadAPOD(date) {
            apodContent.innerHTML = '<div class="loading">우주 데이터를 불러오는 중</div>';
            
            try {
                const url = USE_PROXY 
                    ? `${API_ENDPOINT}?date=${date}`
                    : `${API_ENDPOINT}&date=${date}`;
                    
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('데이터를 불러올 수 없습니다.');
                }
                
                const data = await response.json();
                
                // 설명을 한글로 번역
                const translatedExplanation = await translateToKorean(data.explanation);
                data.translatedExplanation = translatedExplanation;
                
                displayAPOD(data);
            } catch (error) {
                apodContent.innerHTML = `<div class="error">오류가 발생했습니다: ${error.message}</div>`;
            }
        }

        // APOD 표시
        function displayAPOD(data) {
            const mediaContent = data.media_type === 'video' 
                ? `<iframe src="${data.url}" allowfullscreen></iframe>`
                : `<img src="${data.url}" alt="${data.title}" loading="lazy">`;

            apodContent.innerHTML = `
                <div class="apod-container">
                    <div class="image-section">
                        ${mediaContent}
                    </div>
                    <div class="info-section">
                        <div class="date">${formatDate(data.date)}</div>
                        <h2>${data.title}</h2>
                        <div class="description">${data.translatedExplanation}</div>
                        <div class="original-title">Original: ${data.title}</div>
                    </div>
                </div>
            `;
        }

        // 갤러리 로드
        async function loadGallery() {
            galleryContent.innerHTML = '<div class="loading">갤러리를 불러오는 중</div>';
            
            try {
                const dates = getRandomDates(5);
                const promises = dates.map(async date => {
                    const url = USE_PROXY 
                        ? `${API_ENDPOINT}?date=${date}`
                        : `${API_ENDPOINT}&date=${date}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    // 각 항목의 설명도 번역
                    const translatedExplanation = await translateToKorean(data.explanation.substring(0, 200));
                    data.translatedExplanation = translatedExplanation;
                    
                    return data;
                });
                
                const results = await Promise.all(promises);
                displayGallery(results);
            } catch (error) {
                galleryContent.innerHTML = `<div class="error">갤러리를 불러올 수 없습니다: ${error.message}</div>`;
            }
        }

        // 갤러리 표시
        function displayGallery(items) {
            galleryContent.innerHTML = items.map(item => {
                const thumbnail = item.media_type === 'video' 
                    ? `https://img.youtube.com/vi/${getYouTubeID(item.url)}/hqdefault.jpg`
                    : item.url;
                
                return `
                    <div class="gallery-item" onclick="viewGalleryItem('${item.date}')">
                        <div class="gallery-item-image">
                            <img src="${thumbnail}" alt="${item.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/400x250/0B0D17/D4AF37?text=COSMOS'">
                        </div>
                        <div class="info">
                            <div class="date">${formatDate(item.date)}</div>
                            <h3>${item.title}</h3>
                            <div class="excerpt">${item.translatedExplanation || item.explanation.substring(0, 100)}...</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 갤러리 아이템 클릭
        function viewGalleryItem(date) {
            dateInput.value = date;
            todayBtn.click();
            loadAPOD(date);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 랜덤 날짜 생성 (최근 1년)
        function getRandomDates(count) {
            const dates = [];
            const today = new Date();
            const usedDates = new Set();
            
            while (dates.length < count) {
                const randomDays = Math.floor(Math.random() * 365) + 1;
                const date = new Date(today);
                date.setDate(date.getDate() - randomDays);
                const dateString = date.toISOString().split('T')[0];
                
                if (!usedDates.has(dateString)) {
                    usedDates.add(dateString);
                    dates.push(dateString);
                }
            }
            
            return dates;
        }

        // 날짜 포맷
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}.${month}.${day}`;
        }

        // YouTube ID 추출
        function getYouTubeID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // 초기 로드
        loadAPOD(today);
    </script>
</body>
</html>
